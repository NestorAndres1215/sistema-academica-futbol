<app-titulo titulo="Asignacion de Estudiante" >
</app-titulo>
<div class="container   py-5">

    <app-filter-select label="Sedes" [options]="opcionesEquipo" [value]="equipoSeleccionada"
        (valueChange)="equipoSeleccionada = $event; filtrarUsuarios()">
    </app-filter-select>


    <div class="row">
        <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
            <app-button *ngIf="estudiantesFiltrados.length > 0" [label]="modoEdicion ? 'Guardar' : 'Editar'"
                [icon]="modoEdicion ? 'fas fa-save' : 'fas fa-edit'" [color]="modoEdicion ? 'registrar' : 'editar'"
                (onClick)="toggleEdicion()">
            </app-button>
        </div>

        <div class="table-responsive table-container mb-4">
            <table class=" custom-table">
                <thead>
                    <tr>
                        <th>Nombre Completo</th>
                        <th>Rol</th>
                        <th>Posición</th>
                        <th>Número</th>
                        <th>Activo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="estudiantesFiltrados.length === 0">
                        <td colspan="5" style="text-align: center; color: grey;">
                            No hay datos disponibles.
                        </td>
                    </tr>
                    <tr *ngFor="let estudiante of estudiantesFiltrados">
                        <td>
                            {{ estudiante.estudiante.primerNombre + " " + estudiante.estudiante.apellidoPaterno + " " +
                            estudiante.estudiante.apellidoMaterno }}
                        </td>
                        <td class="text-center">
                            <span *ngIf="!modoEdicion">
                                {{ estudiante.esCapitan ? 'Capitán' : '-' }}
                            </span>
                            <mat-form-field *ngIf="modoEdicion" class="small-select" appearance="outline">
                                <mat-select [(ngModel)]="estudiante.esCapitan"
                                    (selectionChange)="verificarCapitan(estudiante)">
                                    <mat-option [value]="true"
                                        [disabled]="capitanSeleccionado && !estudiante.esCapitan">
                                        Capitán
                                    </mat-option>
                                    <mat-option [value]="false">-</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </td>
                        <td class="text-center">
                            <span *ngIf="!modoEdicion">{{ estudiante.posicion }}</span>
                            <mat-form-field *ngIf="modoEdicion" class="small-select" appearance="outline">
                                <mat-select [(ngModel)]="estudiante.posicion">
                                    <mat-option *ngFor="let pos of posiciones" [value]="pos">{{ pos }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </td>
                        <td class="text-center">
                            <span *ngIf="!modoEdicion">{{ estudiante.numeroCamiseta }}</span>

                            <mat-form-field *ngIf="modoEdicion" class="small-select" appearance="outline">
                                <mat-select [(ngModel)]="estudiante.numeroCamiseta"
                                    (selectionChange)="verificarNumeroCamiseta(estudiante)">
                                    <mat-option *ngFor="let num of numerosDisponibles(estudiante)" [value]="num">
                                        {{ num }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </td>
                        <td class="text-center">
                            <span>{{ estudiante.estado ? 'Habilitado' : 'Deshabilitado' }}</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>